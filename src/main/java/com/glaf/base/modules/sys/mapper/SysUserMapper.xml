<?xml version="1.0" encoding="UTF-8" ?> 

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.glaf.base.modules.sys.mapper.SysUserMapper">

	<resultMap id="sysUserResultMap" type="com.glaf.base.modules.sys.model.SysUser">
		<id property="userId" column="USERID" jdbcType="VARCHAR" />
		<result property="name" column="USERNAME" jdbcType="VARCHAR" />
		<result property="namePinyin" column="NAMEPINYIN"
			jdbcType="VARCHAR" />
		<result property="locked" column="LOCKED" jdbcType="INTEGER" />
		<result property="sex" column="SEX" jdbcType="INTEGER" />
		<result property="createTime" column="CREATETIME" jdbcType="TIMESTAMP" />
		<result property="mobile" column="MOBILE" jdbcType="VARCHAR" />
		<result property="mobileVerifyFlag" column="MOBILEVERIFYFLAG_"
			jdbcType="VARCHAR" />
		<result property="email" column="EMAIL" jdbcType="VARCHAR" />
		<result property="telephone" column="TELEPHONE" jdbcType="VARCHAR" />
		<result property="headship" column="HEADSHIP" jdbcType="VARCHAR" />
		<result property="userType" column="USERTYPE" jdbcType="INTEGER" />
		<result property="accountType" column="ACCOUNTTYPE" jdbcType="INTEGER" />
		<result property="organizationId" column="ORGANIZATIONID"
			jdbcType="BIGINT" />
		<result property="tenantId" column="TENANTID" jdbcType="VARCHAR" />
		<result property="adminFlag" column="ISSYSTEM" jdbcType="VARCHAR" />
		<result property="lastLoginTime" column="LASTLOGINTIME"
			jdbcType="TIMESTAMP" />
		<result property="lastLoginIP" column="LASTLOGINIP" jdbcType="VARCHAR" />
		<result property="lockLoginTime" column="LOCKLOGINTIME"
			jdbcType="TIMESTAMP" />
		<result property="loginRetry" column="LOGINRETRY" jdbcType="INTEGER" />
		<result property="secretLoginFlag" column="SECRETLOGINFLAG_"
			jdbcType="VARCHAR" />
		<result property="loginSecret" column="LOGINSECRET_" jdbcType="VARCHAR" />
		<result property="loginSecretUpdateTime" column="LOGINSECRETUPDATETIME_"
			jdbcType="TIMESTAMP" />
		<result property="syncFlag" column="SYNCFLAG" jdbcType="INTEGER" />
		<result property="syncTime" column="SYNCREATETIME" jdbcType="TIMESTAMP" />
		<result property="syncOperatorType" column="SYNCOPERATORTYPE"
			jdbcType="VARCHAR" />
		<result property="deleteFlag" column="DELETEFLAG" jdbcType="INTEGER" />
		<result property="deleteTime" column="DELETETIME" jdbcType="TIMESTAMP" />
	</resultMap>


	<resultMap id="sysUserTokenResultMap" type="com.glaf.base.modules.sys.model.SysUser">
		<id property="userId" column="USERID" jdbcType="VARCHAR" />
		<result property="name" column="USERNAME" jdbcType="VARCHAR" />
		<result property="namePinyin" column="NAMEPINYIN"
			jdbcType="VARCHAR" />
		<result property="locked" column="LOCKED" jdbcType="INTEGER" />
		<result property="sex" column="SEX" jdbcType="INTEGER" />
		<result property="createTime" column="CREATETIME" jdbcType="TIMESTAMP" />
		<result property="mobile" column="MOBILE" jdbcType="VARCHAR" />
		<result property="mobileVerifyFlag" column="MOBILEVERIFYFLAG_"
			jdbcType="VARCHAR" />
		<result property="email" column="EMAIL" jdbcType="VARCHAR" />
		<result property="telephone" column="TELEPHONE" jdbcType="VARCHAR" />
		<result property="headship" column="HEADSHIP" jdbcType="VARCHAR" />
		<result property="userType" column="USERTYPE" jdbcType="INTEGER" />
		<result property="accountType" column="ACCOUNTTYPE" jdbcType="INTEGER" />
		<result property="organizationId" column="ORGANIZATIONID"
			jdbcType="BIGINT" />
		<result property="tenantId" column="TENANTID" jdbcType="VARCHAR" />
		<result property="adminFlag" column="ISSYSTEM" jdbcType="VARCHAR" />
		<result property="lastLoginTime" column="LASTLOGINTIME"
			jdbcType="TIMESTAMP" />
		<result property="lastLoginIP" column="LASTLOGINIP" jdbcType="VARCHAR" />
		<result property="lockLoginTime" column="LOCKLOGINTIME"
			jdbcType="TIMESTAMP" />
		<result property="loginRetry" column="LOGINRETRY" jdbcType="INTEGER" />
		<result property="secretLoginFlag" column="SECRETLOGINFLAG_"
			jdbcType="VARCHAR" />
		<result property="loginSecret" column="LOGINSECRET_" jdbcType="VARCHAR" />
		<result property="loginSecretUpdateTime" column="LOGINSECRETUPDATETIME_"
			jdbcType="TIMESTAMP" />
		<result property="token" column="TOKEN" jdbcType="VARCHAR" />
		<result property="tokenTime" column="TOKENTIME" jdbcType="TIMESTAMP" />
		<result property="syncFlag" column="SYNCFLAG" jdbcType="INTEGER" />
		<result property="syncTime" column="SYNCREATETIME" jdbcType="TIMESTAMP" />
		<result property="syncOperatorType" column="SYNCOPERATORTYPE"
			jdbcType="VARCHAR" />
		<result property="deleteFlag" column="DELETEFLAG" jdbcType="INTEGER" />
	</resultMap>


	<resultMap id="sysUserLoginSecretResultMap" type="com.glaf.base.modules.sys.model.SysUser">
		<id property="userId" column="USERID" jdbcType="VARCHAR" />
		<result property="name" column="USERNAME" jdbcType="VARCHAR" />
		<result property="namePinyin" column="NAMEPINYIN"
			jdbcType="VARCHAR" />
		<result property="locked" column="LOCKED" jdbcType="INTEGER" />
		<result property="sex" column="SEX" jdbcType="INTEGER" />
		<result property="createTime" column="CREATETIME" jdbcType="TIMESTAMP" />
		<result property="mobile" column="MOBILE" jdbcType="VARCHAR" />
		<result property="mobileVerifyFlag" column="MOBILEVERIFYFLAG_"
			jdbcType="VARCHAR" />
		<result property="email" column="EMAIL" jdbcType="VARCHAR" />
		<result property="telephone" column="TELEPHONE" jdbcType="VARCHAR" />
		<result property="headship" column="HEADSHIP" jdbcType="VARCHAR" />
		<result property="userType" column="USERTYPE" jdbcType="INTEGER" />
		<result property="accountType" column="ACCOUNTTYPE" jdbcType="INTEGER" />
		<result property="organizationId" column="ORGANIZATIONID"
			jdbcType="BIGINT" />
		<result property="tenantId" column="TENANTID" jdbcType="VARCHAR" />
		<result property="adminFlag" column="ISSYSTEM" jdbcType="VARCHAR" />
		<result property="lastLoginTime" column="LASTLOGINTIME"
			jdbcType="TIMESTAMP" />
		<result property="lastLoginIP" column="LASTLOGINIP" jdbcType="VARCHAR" />
		<result property="lockLoginTime" column="LOCKLOGINTIME"
			jdbcType="TIMESTAMP" />
		<result property="loginRetry" column="LOGINRETRY" jdbcType="INTEGER" />
		<result property="secretLoginFlag" column="SECRETLOGINFLAG_"
			jdbcType="VARCHAR" />
		<result property="loginSecret" column="LOGINSECRET_" jdbcType="VARCHAR" />
		<result property="loginSecretUpdateTime" column="LOGINSECRETUPDATETIME_"
			jdbcType="TIMESTAMP" />
		<result property="syncFlag" column="SYNCFLAG" jdbcType="INTEGER" />
		<result property="syncTime" column="SYNCREATETIME" jdbcType="TIMESTAMP" />
		<result property="syncOperatorType" column="SYNCOPERATORTYPE"
			jdbcType="VARCHAR" />
		<result property="deleteFlag" column="DELETEFLAG" jdbcType="INTEGER" />
	</resultMap>


	<resultMap id="userPasswordResultMap" type="com.glaf.base.modules.sys.model.UserPassword">
		<id property="userId" column="USERID" jdbcType="VARCHAR" />
		<result property="password" column="PASSWORD_HASH" jdbcType="VARCHAR" />
	</resultMap>


	<insert id="insertSysUser" parameterType="com.glaf.base.modules.sys.model.SysUser">
		insert into SYS_USER
		<trim prefix="(" suffix=")" suffixOverrides=",">
			USERID
			<if test="passwordHash != null">
				,PASSWORD_HASH
			</if>
			<if test="name != null">
				,USERNAME
			</if>
			<if test="namePinyin != null">
				,NAMEPINYIN
			</if>
			<if test="locked != null">
				,LOCKED
			</if>
			<if test="sex != null">
				,SEX
			</if>
			<if test="createBy != null">
				,CREATEBY
			</if>
			<if test="createTime != null">
				,CREATETIME
			</if>
			<if test="mobile != null">
				,MOBILE
			</if>
			<if test="mobileVerifyFlag != null">
				,MOBILEVERIFYFLAG_
			</if>
			<if test="email != null">
				,EMAIL
			</if>
			<if test="telephone != null">
				,TELEPHONE
			</if>
			<if test="headship != null">
				,HEADSHIP
			</if>
			<if test="userType != null">
				,USERTYPE
			</if>
			<if test="accountType != null">
				,ACCOUNTTYPE
			</if>
			<if test="organizationId != null">
				,ORGANIZATIONID
			</if>
			<if test="tenantId != null">
				,TENANTID
			</if>
			<if test="adminFlag != null">
				,ISSYSTEM
			</if>
			<if test="lastLoginTime != null">
				,LASTLOGINTIME
			</if>
			<if test="lastLoginIP != null">
				,LASTLOGINIP
			</if>
			<if test="lockLoginTime != null">
				,LOCKLOGINTIME
			</if>
			<if test="loginRetry != null">
				,LOGINRETRY
			</if>
			<if test="secretLoginFlag != null">
				,SECRETLOGINFLAG_
			</if>
			<if test="loginSecret != null">
				,LOGINSECRET_
			</if>
			<if test="loginSecretUpdateTime != null">
				,LOGINSECRETUPDATETIME_
			</if>
			<if test="token != null">
				,TOKEN
			</if>
			<if test="tokenTime != null">
				,TOKENTIME
			</if>
			<if test="syncFlag != null">
				,SYNCFLAG
			</if>
			<if test="syncTime != null">
				,SYNCREATETIME
			</if>
			<if test="syncOperatorType != null">
				,SYNCOPERATORTYPE
			</if>
			<if test="deleteFlag != null">
				,DELETEFLAG
			</if>
			<if test="deleteTime != null">
				,DELETETIME
			</if>
		</trim>

		<trim prefix=" values (" suffix=")" suffixOverrides=",">
			#{userId, jdbcType=VARCHAR}

			<if test="passwordHash != null">
				,#{passwordHash, jdbcType=VARCHAR}
			</if>
			<if test="name != null">
				,#{name, jdbcType=VARCHAR}
			</if>
			<if test="namePinyin != null">
				,#{namePinyin, jdbcType=VARCHAR}
			</if>
			<if test="locked != null">
				,#{locked, jdbcType=VARCHAR}
			</if>
			<if test="sex != null">
				,#{sex, jdbcType=VARCHAR}
			</if>
			<if test="createBy != null">
				,#{createBy, jdbcType=VARCHAR}
			</if>
			<if test="createTime != null">
				,#{createTime, jdbcType=TIMESTAMP}
			</if>
			<if test="mobile != null">
				,#{mobile, jdbcType=VARCHAR}
			</if>
			<if test="mobileVerifyFlag != null">
				,#{mobileVerifyFlag, jdbcType=VARCHAR}
			</if>
			<if test="email != null">
				,#{email, jdbcType=VARCHAR}
			</if>
			<if test="telephone != null">
				,#{telephone, jdbcType=VARCHAR}
			</if>
			<if test="headship != null">
				,#{headship, jdbcType=VARCHAR}
			</if>
			<if test="userType != null">
				,#{userType, jdbcType=INTEGER}
			</if>
			<if test="accountType != null">
				,#{accountType, jdbcType=INTEGER}
			</if>
			<if test="organizationId != null">
				,#{organizationId, jdbcType=BIGINT}
			</if>
			<if test="tenantId != null">
				,#{tenantId, jdbcType=VARCHAR}
			</if>
			<if test="adminFlag != null">
				,#{adminFlag, jdbcType=VARCHAR}
			</if>
			<if test="lastLoginTime != null">
				,#{lastLoginTime, jdbcType=TIMESTAMP}
			</if>
			<if test="lastLoginIP != null">
				,#{lastLoginIP, jdbcType=VARCHAR}
			</if>
			<if test="lockLoginTime != null">
				,#{lockLoginTime, jdbcType=TIMESTAMP}
			</if>
			<if test="loginRetry != null">
				,#{loginRetry, jdbcType=INTEGER}
			</if>
			<if test="secretLoginFlag != null">
				,#{secretLoginFlag, jdbcType=VARCHAR}
			</if>
			<if test="loginSecret != null">
				,#{loginSecret, jdbcType=VARCHAR}
			</if>
			<if test="loginSecretUpdateTime != null">
				,#{loginSecretUpdateTime, jdbcType=TIMESTAMP}
			</if>
			<if test="token != null">
				,#{token, jdbcType=VARCHAR}
			</if>
			<if test="tokenTime != null">
				,#{tokenTime, jdbcType=TIMESTAMP}
			</if>
			<if test="syncFlag != null">
				,#{syncFlag, jdbcType=INTEGER}
			</if>
			<if test="syncTime != null">
				,#{syncTime, jdbcType=TIMESTAMP}
			</if>
			<if test="syncOperatorType != null">
				,#{syncOperatorType, jdbcType=VARCHAR}
			</if>
			<if test="deleteFlag != null">
				,#{deleteFlag, jdbcType=INTEGER}
			</if>
			<if test="deleteTime != null">
				,#{deleteTime, jdbcType=TIMESTAMP}
			</if>
		</trim>
	</insert>


	<update id="resetUserToken" parameterType="com.glaf.base.modules.sys.model.SysUser">

		update SYS_USER
		set
		TOKEN = #{token, jdbcType=VARCHAR},
		TOKENTIME = #{tokenTime,
		jdbcType=TIMESTAMP}
		where USERID = #{userId, jdbcType=VARCHAR}

	</update>


	<update id="updateSysUser" parameterType="com.glaf.base.modules.sys.model.SysUser">
		update SYS_USER
		set
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="name != null">
				USERNAME = #{name, jdbcType=VARCHAR},
			</if>
			<if test="namePinyin != null">
				NAMEPINYIN = #{namePinyin, jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				SEX = #{sex, jdbcType=INTEGER},
			</if>
			<if test="locked != null">
				LOCKED = #{locked, jdbcType=INTEGER},
			</if>
			<if test="mobile != null">
				MOBILE = #{mobile, jdbcType=VARCHAR},
			</if>
			<if test="mobileVerifyFlag != null and mobileVerifyFlag != ''">
				MOBILEVERIFYFLAG_ = #{mobileVerifyFlag,
				jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				EMAIL = #{email, jdbcType=VARCHAR},
			</if>
			<if test="telephone != null">
				TELEPHONE = #{telephone, jdbcType=VARCHAR},
			</if>
			<if test="headship != null">
				HEADSHIP = #{headship, jdbcType=VARCHAR},
			</if>
			<if test="userType != null">
				USERTYPE = #{userType, jdbcType=INTEGER},
			</if>
			<if test="accountType != null">
				ACCOUNTTYPE = #{accountType, jdbcType=INTEGER},
			</if>
			<if test="organizationId != null">
				ORGANIZATIONID = #{organizationId, jdbcType=BIGINT},
			</if>
			<if test="adminFlag != null">
				ISSYSTEM = #{adminFlag, jdbcType=VARCHAR},
			</if>
			<if test="lastLoginTime != null">
				LASTLOGINTIME = #{lastLoginTime, jdbcType=TIMESTAMP},
			</if>
			<if test="lastLoginIP != null">
				LASTLOGINIP = #{lastLoginIP, jdbcType=VARCHAR},
			</if>
			<if test="lockLoginTime != null">
				LOCKLOGINTIME = #{lockLoginTime, jdbcType=TIMESTAMP},
			</if>
			<if test="loginRetry != null">
				LOGINRETRY = #{loginRetry, jdbcType=INTEGER},
			</if>
			<if test="secretLoginFlag != null">
				SECRETLOGINFLAG_ = #{secretLoginFlag, jdbcType=VARCHAR},
			</if>
			<if test="loginSecret != null">
				LOGINSECRET_ = #{loginSecret, jdbcType=VARCHAR},
			</if>
			<if test="loginSecretUpdateTime != null">
				LOGINSECRETUPDATETIME_ = #{loginSecretUpdateTime,
				jdbcType=TIMESTAMP},
			</if>
			<if test="syncFlag != null">
				SYNCFLAG = #{syncFlag, jdbcType=INTEGER},
			</if>
			<if test="syncTime != null">
				SYNCREATETIME = #{syncTime, jdbcType=TIMESTAMP},
			</if>
			<if test="syncOperatorType != null">
				SYNCOPERATORTYPE = #{syncOperatorType, jdbcType=VARCHAR},
			</if>
			<if test="deleteFlag != null">
				DELETEFLAG = #{deleteFlag, jdbcType=INTEGER},
			</if>
			<if test="deleteTime != null">
				DELETETIME = #{deleteTime, jdbcType=TIMESTAMP},
			</if>
		</trim>
		where
		USERID = #{userId, jdbcType=VARCHAR}

	</update>


	<update id="updateSysUserLoginInfo" parameterType="com.glaf.base.modules.sys.model.SysUser">
		update SYS_USER
		set
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="lastLoginTime != null">
				LASTLOGINTIME = #{lastLoginTime, jdbcType=TIMESTAMP},
			</if>
			<if test="lastLoginIP != null">
				LASTLOGINIP = #{lastLoginIP, jdbcType=VARCHAR},
			</if>
			<if test="lockLoginTime != null">
				LOCKLOGINTIME = #{lockLoginTime, jdbcType=TIMESTAMP},
			</if>
			<if test="loginRetry != null">
				LOGINRETRY = #{loginRetry, jdbcType=INTEGER},
			</if>
			<if test="secretLoginFlag != null">
				SECRETLOGINFLAG_ = #{secretLoginFlag, jdbcType=VARCHAR},
			</if>
			<if test="loginSecret != null">
				LOGINSECRET_ = #{loginSecret, jdbcType=VARCHAR},
			</if>
			<if test="loginSecretUpdateTime != null">
				LOGINSECRETUPDATETIME_ = #{loginSecretUpdateTime,
				jdbcType=TIMESTAMP},
			</if>
		</trim>
		where
		USERID = #{userId, jdbcType=VARCHAR}

	</update>


	<update id="resetLoginStatus" parameterType="com.glaf.base.modules.sys.model.SysUser">

		update SYS_USER
		set
		LOGINRETRY = #{loginRetry, jdbcType=INTEGER},
		LOCKLOGINTIME =
		#{lockLoginTime, jdbcType=TIMESTAMP},
		LOGINSECRET_ =
		#{loginSecret,jdbcType=VARCHAR},
		LOGINSECRETUPDATETIME_ =
		#{loginSecretUpdateTime,jdbcType=TIMESTAMP}
		where USERID =
		#{userId,jdbcType=VARCHAR}

	</update>


	<update id="resetStatus" parameterType="com.glaf.base.modules.sys.model.SysUser">

		update SYS_USER
		set LOCKED
		= #{locked, jdbcType=INTEGER}
		where USERID =
		#{userId,jdbcType=VARCHAR}

	</update>


	<update id="updateUserLoginRetry" parameterType="com.glaf.base.modules.sys.model.SysUser">

		update SYS_USER
		set LOGINRETRY = #{loginRetry, jdbcType=INTEGER},
		LOCKLOGINTIME =
		#{lockLoginTime, jdbcType=TIMESTAMP}
		where USERID =
		#{userId,jdbcType=VARCHAR}

	</update>


	<update id="updateUserPassword" parameterType="com.glaf.base.modules.sys.model.SysUser">

		update SYS_USER
		set
		LOGINRETRY = 0,
		LOCKLOGINTIME = null,
		PASSWORD_HASH = #{passwordHash,jdbcType=VARCHAR}
		where USERID = #{userId,jdbcType=VARCHAR}

	</update>


	<update id="updateUserLoginSecret" parameterType="com.glaf.base.modules.sys.model.SysUser">

		update SYS_USER
		set
		LOGINRETRY = 0,
		LOCKLOGINTIME = null,
		LOGINSECRET_ =
		#{loginSecret,jdbcType=VARCHAR},
		LOGINSECRETUPDATETIME_ =
		#{loginSecretUpdateTime,jdbcType=TIMESTAMP}
		where USERID =
		#{userId,jdbcType=VARCHAR}

	</update>


	<delete id="deleteSysUserById" parameterType="string">

		delete from
		SYS_USER
		where USERID = #{userId}

	</delete>


	<select id="getSysUsersByRoleCode" parameterType="string"
		resultMap="sysUserResultMap">

		select distinct a.*
		from SYS_USER a
		inner join SYS_USER_ROLE b
		on
		a.USERID = b.USERID
		inner join SYS_ROLE c
		on b.ROLEID = c.ID
		where
		c.CODE
		= #{roleCode}
		and a.DELETEFLAG = 0
		order by a.LOCKED asc,
		a.USERNAME asc

	</select>


	<select id="getSysUsersByPostId" parameterType="long"
		resultMap="sysUserResultMap">

		select distinct a.*
		from SYS_USER a
		inner join SYS_POST_USER b
		on a.USERID = b.USERID
		where b.POSTID = #{postId}
		and a.DELETEFLAG = 0
		order by a.LOCKED asc, a.UserName asc

	</select>


	<select id="getSysUsersByRoleId" parameterType="string"
		resultMap="sysUserResultMap">

		select distinct a.*
		from SYS_USER a
		inner join SYS_USER_ROLE b
		on
		a.USERID = b.USERID
		inner join SYS_ROLE c
		on b.ROLEID = c.ID
		where c.ID
		=
		#{roleId}
		and a.DELETEFLAG = 0
		order by a.LOCKED asc, a.USERNAME asc

	</select>


	<select id="getSysUsersByRoleIds" parameterType="map"
		resultMap="sysUserResultMap">

		select distinct a.*
		from SYS_USER a
		inner join SYS_USER_ROLE b
		on
		a.USERID = b.USERID
		inner join SYS_ROLE c
		on b.ROLEID = c.ID
		where 1=1
		and a.DELETEFLAG = 0

		<if test="roleIds != null and roleIds.size != 0">
			AND c.ID IN
			<foreach item="x_roleId" index="index" collection="roleIds"
				open="(" separator="," close=")">
				#{x_roleId}
			</foreach>
		</if>

		order by a.LOCKED asc, a.USERNAME asc

	</select>


	<select id="getSysUsersByTenantId" parameterType="string"
		resultMap="sysUserResultMap">

		select distinct a.*
		from SYS_USER a
		where a.TENANTID =
		#{tenantId}
		and a.DELETEFLAG = 0
		order by a.LOCKED asc, a.UserName asc

	</select>


	<select id="getSysUserLoginSecret" parameterType="String"
		resultMap="sysUserLoginSecretResultMap">
		select * from SYS_USER where USERID = #{userId}
	</select>


	<select id="getSysUserLoginSecretList" parameterType="com.glaf.base.modules.sys.query.SysUserQuery"
		resultMap="sysUserLoginSecretResultMap">

		select E.* from SYS_USER E
		where 1=1
		and E.DELETEFLAG = 0

		<include refid="selectSysUsersSql" />

		<choose>
			<when test="orderBy != null">
				order by ${orderBy}
			</when>
			<otherwise>
				order by E.LOCKED asc, E.USERNAME asc
			</otherwise>
		</choose>

	</select>


	<select id="getSysUserByAccount" parameterType="String"
		resultMap="sysUserResultMap">
		select * from SYS_USER where USERID = #{userId}
	</select>


	<select id="getSysUserByAppId" parameterType="String"
		resultMap="sysUserTokenResultMap">
		select * from SYS_USER where APPID = #{appId}
	</select>


	<select id="getSysUserByMail" parameterType="string" resultMap="sysUserResultMap">
		select * from SYS_USER where EMAIL = #{mail}
	</select>


	<select id="getSysUserByMobile" parameterType="string"
		resultMap="sysUserResultMap">
		select * from SYS_USER where MOBILE = #{mobile}
	</select>


	<select id="getPasswordHashByAccount" parameterType="String"
		resultType="String">
		select PASSWORD_HASH from SYS_USER where USERID = #{userId}
	</select>


	<select id="getAllUserPasswords" resultMap="userPasswordResultMap">
		select USERID,
		PASSWORD_HASH
		from SYS_USER
	</select>


	<select id="getCountAuthorizedUsers" parameterType="com.glaf.base.modules.sys.query.SysUserQuery"
		resultType="int">

		select count(distinct E.USERID) from SYS_USER E
		inner join
		SYS_USER_ROLE R
		on E.USERID = R.USERID
		where 1=1
		and E.DELETEFLAG = 0

		<if test="organizationId != null  ">
			and E.ORGANIZATIONID = #{organizationId}
		</if>

		<if test="tenantId != null  ">
			and E.TENANTID = #{tenantId}
		</if>

		<if test="nameLike != null and nameLike != '' ">
			and E.USERNAME like #{nameLike}
		</if>

		<if test="availDateStartGreaterThanOrEqual != null">
			and R.AVAILDATESTART &gt;=
			#{availDateStartGreaterThanOrEqual}
		</if>

		<if test="availDateStartLessThanOrEqual != null">
			and R.AVAILDATESTART &lt;=
			#{availDateStartLessThanOrEqual}
		</if>

		<if test="availDateEndGreaterThanOrEqual != null">
			and R.AVAILDATEEND &gt;= #{availDateEndGreaterThanOrEqual}
		</if>

		<if test="availDateEndLessThanOrEqual != null">
			and R.AVAILDATEEND &lt;= #{availDateEndLessThanOrEqual}
		</if>

	</select>


	<select id="getAuthorizedUsers" parameterType="com.glaf.base.modules.sys.query.SysUserQuery"
		resultMap="sysUserResultMap">

		select distinct E.* from SYS_USER E
		inner join SYS_USER_ROLE R
		on
		E.USERID =
		R.USERID
		where 1=1
		and E.DELETEFLAG = 0

		<if test="organizationId != null  ">
			and E.ORGANIZATIONID = #{organizationId}
		</if>

		<if test="tenantId != null  ">
			and E.TENANTID = #{tenantId}
		</if>

		<if test="nameLike != null and nameLike != '' ">
			and E.USERNAME like #{nameLike}
		</if>

		<if test="availDateStartGreaterThanOrEqual != null">
			and R.AVAILDATESTART &gt;=
			#{availDateStartGreaterThanOrEqual}
		</if>

		<if test="availDateStartLessThanOrEqual != null">
			and R.AVAILDATESTART &lt;=
			#{availDateStartLessThanOrEqual}
		</if>

		<if test="availDateEndGreaterThanOrEqual != null">
			and R.AVAILDATEEND &gt;= #{availDateEndGreaterThanOrEqual}
		</if>

		<if test="availDateEndLessThanOrEqual != null">
			and R.AVAILDATEEND &lt;= #{availDateEndLessThanOrEqual}
		</if>

		<if test="userType != null ">
			and E.USERTYPE = #{userType}
		</if>

		order by E.USERID asc

	</select>


	<select id="getAuthorizedUsersByUserId" parameterType="string"
		resultMap="sysUserResultMap">

		select distinct E.* from SYS_USER E
		inner join SYS_USER_ROLE
		R
		on
		E.USERID = R.USERID
		where R.AUTHORIZEFROM = #{authorizeFrom}
		and
		E.DELETEFLAG = 0
		order by E.LOCKED asc, E.USERNAME asc

	</select>


	<select id="getRoleUserViews" parameterType="com.glaf.base.modules.sys.query.UserRoleQuery"
		resultType="com.glaf.base.modules.sys.model.UserRole">

		select u.USERID as actorId, u.USERNAME as actorName, r.ID as roleId,
		r.CODE as roleCode, r.ROLENAME as roleName
		from SYS_USER u
		inner join
		USERROLE ur
		on u.USERID = ur.USERID
		inner join SYS_ROLE r
		on ur.ROLEID =
		r.ID
		where 1=1
		and u.DELETEFLAG = 0

		<if test="actorId != null and actorId != '' ">
			and u.USERID = #{actorId}
		</if>

		<if test="actorIds != null and actorIds.size != 0">
			and u.USERID IN
			<foreach item="x_userId" index="index" collection="actorIds"
				open="(" separator="," close=")">
				#{x_userId}
			</foreach>
		</if>

		<if test="organizationId != null">
			and u.ORGANIZATIONID = #{organizationId}
		</if>

		<if test="organizationIds != null and organizationIds.size != 0">
			and u.ORGANIZATIONID IN
			<foreach item="x_organizationId" index="index" collection="organizationIds"
				open="(" separator="," close=")">
				#{x_organizationId}
			</foreach>
		</if>

		<if test="tenantId != null  ">
			and E.TENANTID = #{tenantId}
		</if>

		<if test="roleId != null">
			and r.ID = #{roleId}
		</if>

		<if test="roleIds != null and roleIds.size != 0">
			and r.ID IN
			<foreach item="x_roleId" index="index" collection="roleIds"
				open="(" separator="," close=")">
				#{x_roleId}
			</foreach>
		</if>

		<if test="roleCode != null">
			and r.CODE = #{roleCode}
		</if>

		<if test="roleCodes != null and roleCodes.size != 0">
			and r.CODE IN
			<foreach item="x_roleCode" index="index" collection="roleCodes"
				open="(" separator="," close=")">
				#{x_roleCode}
			</foreach>
		</if>

	</select>


	<select id="getSysUsers" parameterType="com.glaf.base.modules.sys.query.SysUserQuery"
		resultMap="sysUserResultMap">
		select E.*
		<include refid="selectSysUsersSql" />
		<choose>
			<when test="orderBy != null">
				order by ${orderBy}
			</when>
			<otherwise>
				order by E.LOCKED asc, E.USERNAME asc
			</otherwise>
		</choose>
	</select>

	<select id="getSysUserCount" parameterType="com.glaf.base.modules.sys.query.SysUserQuery"
		resultType="int">
		select count(*)
		<include refid="selectSysUsersSql" />
	</select>

	<sql id="selectSysUsersSql">

		from SYS_USER E

		<if test="organizationNameLike != null and organizationNameLike != '' ">
			inner join SYS_DEPARTMENT D
			on E.ORGANIZATIONID = D.ID
		</if>

		<where>
			1 = 1

			<if test="userId != null and userId != '' ">
				and E.USERID = #{userId}
			</if>

			<if test="userIds != null and userIds.size != 0">
				and E.USERID IN
				<foreach item="x_userId" index="index" collection="userIds"
					open="(" separator="," close=")">
					#{x_userId}
				</foreach>
			</if>

			<if test="name != null and name != '' ">
				and E.USERNAME = #{name}
			</if>

			<if test="nameLike != null and nameLike != '' ">
				and E.USERNAME like #{nameLike}
			</if>
			
			<if test="namePinyinLike != null and namePinyinLike != '' ">
				and ( E.USERNAME like #{namePinyinLike} or E.NAMEPINYIN
				like #{namePinyinLike} )
			</if>

			<if test="createTimeGreaterThanOrEqual != null">
				and E.CREATETIME &gt;= #{createTimeGreaterThanOrEqual}
			</if>

			<if test="createTimeLessThanOrEqual != null">
				and E.CREATETIME &lt;= #{createTimeLessThanOrEqual}
			</if>

			<if test="mobile != null and mobile != '' ">
				and E.MOBILE = #{mobile}
			</if>

			<if test="mobileLike != null and mobileLike != '' ">
				and E.MOBILE like #{mobileLike}
			</if>

			<if test="email != null and email != '' ">
				and E.EMAIL = #{email}
			</if>

			<if test="emailLike != null and emailLike != '' ">
				and E.EMAIL like #{emailLike}
			</if>

			<if test="organizationId != null">
				and E.ORGANIZATIONID = #{organizationId}
			</if>

			<if test="organizationIds != null and organizationIds.size != 0">
				and E.ORGANIZATIONID IN
				<foreach item="x_organizationId" index="index" collection="organizationIds"
					open="(" separator="," close=")">
					#{x_organizationId}
				</foreach>
			</if>

			<if test="organizationNameLike != null and organizationNameLike != '' ">
				and D.NAME like #{organizationNameLike}
			</if>

			<if test="tenantId != null  ">
				and E.TENANTID = #{tenantId}
			</if>

			<if test="adminFlag != null and adminFlag != '' ">
				and E.ISSYSTEM = #{adminFlag}
			</if>

			<if test="syncFlag != null">
				and E.SYNCFLAG = #{syncFlag}
			</if>

			<if test="syncOperatorType != null and syncOperatorType != '' ">
				and E.SYNCOPERATORTYPE = #{syncOperatorType}
			</if>

			<if test="deleteFlag != null">
				and E.DELETEFLAG = #{deleteFlag}
			</if>

			<if test="groupUserId != null and groupUserId != '' ">
				and E.USERID not in ( select USERID from SYS_GROUP_USER
				where GROUPID=#{groupUserId})
			</if>

			<if test="groupLeaderId != null and groupLeaderId != '' ">
				and E.USERID not in ( select USERID from SYS_GROUP_LEADER
				where GROUPID=#{groupLeaderId})
			</if>

			<if test="userIdsNotIn != null and userIdsNotIn.size != 0">
				and E.USERID NOT IN
				<foreach item="x_userId" index="index" collection="userIdsNotIn"
					open="(" separator="," close=")">
					#{x_userId}
				</foreach>
			</if>

			<if test="userType != null ">
				and E.USERTYPE = #{userType}
			</if>
		</where>
	</sql>

</mapper>